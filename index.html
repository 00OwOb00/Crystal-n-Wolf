<!DOCTYPE html>
<html lang="zh-TW">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>æ°´æ™¶èˆ‡ç‹¼ Crystal & Wolf</title>
Â  Â Â 
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Allura&family=Cormorant+Garamond:wght@400;600&family=Press+Start+2P&display=swap" rel="stylesheet">

Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
Â  Â  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
Â  Â  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
Â  Â  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/DRACOLoader.js"></script>

Â  Â  <script src="./data/crystalsText.js"></script>
Â  Â  <script src="./data/wolfData.js"></script>

Â  Â  <style>
Â  Â  Â  Â  :root {
Â  Â  Â  Â  Â  Â  --gold: #D4AF37;
Â  Â  Â  Â  Â  Â  --pixel-font: 'Press Start 2P', cursive;
Â  Â  Â  Â  Â  Â  --serif-font: 'Cormorant Garamond', serif;
Â  Â  Â  Â  }

Â  Â  Â  Â  body, html { margin: 0; overflow: hidden; background: #050505; font-family: var(--serif-font); color: #fff; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* èƒŒæ™¯èˆ‡ç•«å¸ƒ */
Â  Â  Â  Â  #canvas-wrapper { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; transition: width 1s ease; }
Â  Â  Â  Â  body.result-mode #canvas-wrapper { width: 60%; }

Â  Â  Â  Â  /* UI å±¤ */
Â  Â  Â  Â  #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; pointer-events: none; }
Â  Â  Â  Â  .pointer-auto { pointer-events: auto; }

Â  Â  Â  Â  /* é ‚éƒ¨å°èˆª */
Â  Â  Â  Â  .top-bar { position: absolute; width: 100%; padding: 20px 40px; display: flex; justify-content: space-between; align-items: center; box-sizing: border-box; }
Â  Â  Â  Â  .logo { font-family: 'Allura', cursive; font-size: 2rem; color: #fff; text-shadow: 0 0 10px rgba(255,255,255,0.5); }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* éŸ³æ¨‚æ§åˆ¶ */
Â  Â  Â  Â  .audio-btn { background: none; border: 1px solid var(--gold); color: var(--gold); padding: 5px 10px; cursor: pointer; border-radius: 5px; font-size: 0.8rem; }

Â  Â  Â  Â  /* ä¸­å¤®å€åŸŸï¼šå°ç‹¼èˆ‡æŒ‰éˆ• */
Â  Â  Â  Â  #center-stage {
Â  Â  Â  Â  Â  Â  position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
Â  Â  Â  Â  Â  Â  display: flex; flex-direction: column; align-items: center; gap: 20px;
Â  Â  Â  Â  Â  Â  transition: opacity 0.5s;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* åƒç´ å°ç‹¼ç•«å¸ƒ */
Â  Â  Â  Â  #wolf-canvas {
Â  Â  Â  Â  Â  Â  width: 160px; height: 160px;
Â  Â  Â  Â  Â  Â  image-rendering: pixelated; /* é—œéµï¼šè®“åƒç´ åœ–ä¸æ¨¡ç³Š */
Â  Â  Â  Â  Â  Â  filter: drop-shadow(0 0 10px rgba(255,255,255,0.2));
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* æŒ‰éˆ•æ¨£å¼ */
Â  Â  Â  Â  .cta-button {
Â  Â  Â  Â  Â  Â  background: rgba(0,0,0,0.6); border: 2px solid var(--gold); color: var(--gold);
Â  Â  Â  Â  Â  Â  padding: 15px 30px; font-family: var(--serif-font); font-size: 1.3rem; letter-spacing: 2px;
Â  Â  Â  Â  Â  Â  cursor: pointer; transition: all 0.3s; backdrop-filter: blur(5px);
Â  Â  Â  Â  Â  Â  display: flex; align-items: center; gap: 10px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .cta-button:hover { background: var(--gold); color: #000; box-shadow: 0 0 20px var(--gold); }

Â  Â  Â  Â  /* è’è—å¤¾æŒ‰éˆ• */
Â  Â  Â  Â  .wardrobe-btn {
Â  Â  Â  Â  Â  Â  margin-top: 10px; font-family: var(--pixel-font); font-size: 0.7rem;Â 
Â  Â  Â  Â  Â  Â  color: #aaa; background: none; border: none; cursor: pointer; text-decoration: underline;
Â  Â  Â  Â  }
Â  Â  Â  Â  .wardrobe-btn:hover { color: #fff; }

Â  Â  Â  Â  /* æ¯æ—¥çå‹µé€šçŸ¥ */
Â  Â  Â  Â  #reward-toast {
Â  Â  Â  Â  Â  Â  position: absolute; top: -50px; opacity: 0; background: var(--gold); color: #000;
Â  Â  Â  Â  Â  Â  padding: 10px 20px; border-radius: 20px; font-family: var(--pixel-font); font-size: 0.8rem;
Â  Â  Â  Â  Â  Â  transition: all 0.5s; pointer-events: none; white-space: nowrap;
Â  Â  Â  Â  }
Â  Â  Â  Â  #reward-toast.show { top: -80px; opacity: 1; }

Â  Â  Â  Â  /* è¼‰å…¥ç•«é¢ */
Â  Â  Â  Â  #loading-screen {
Â  Â  Â  Â  Â  Â  position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
Â  Â  Â  Â  Â  Â  color: var(--gold); text-align: center; pointer-events: none; transition: opacity 0.5s;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* è’è—å¤¾ Modal */
Â  Â  Â  Â  #wardrobe-modal {
Â  Â  Â  Â  Â  Â  display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
Â  Â  Â  Â  Â  Â  background: rgba(0,0,0,0.85); z-index: 100; align-items: center; justify-content: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  .wardrobe-content {
Â  Â  Â  Â  Â  Â  background: #111; border: 2px solid var(--gold); width: 90%; max-width: 600px;
Â  Â  Â  Â  Â  Â  height: 80vh; padding: 20px; border-radius: 10px; display: flex; flex-direction: column;
Â  Â  Â  Â  Â  Â  color: #fff; font-family: var(--serif-font);
Â  Â  Â  Â  }
Â  Â  Â  Â  .wardrobe-tabs { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 5px; }
Â  Â  Â  Â  .tab-btn { background: #333; border: none; color: #aaa; padding: 8px 15px; cursor: pointer; font-family: var(--pixel-font); font-size: 0.6rem; }
Â  Â  Â  Â  .tab-btn.active { background: var(--gold); color: #000; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .wardrobe-grid {Â 
Â  Â  Â  Â  Â  Â  display: grid; grid-template-columns: repeat(auto-fill, minmax(60px, 1fr)); gap: 10px;Â 
Â  Â  Â  Â  Â  Â  overflow-y: auto; flex: 1; padding: 10px; background: #000; border: 1px solid #333;
Â  Â  Â  Â  }
Â  Â  Â  Â  .wardrobe-item {
Â  Â  Â  Â  Â  Â  width: 50px; height: 50px; border: 1px solid #444; cursor: pointer; position: relative;
Â  Â  Â  Â  Â  Â  image-rendering: pixelated; display: flex; justify-content: center; align-items: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  .wardrobe-item.locked { opacity: 0.3; cursor: not-allowed; background: #222; }
Â  Â  Â  Â  .wardrobe-item.active { border: 2px solid var(--gold); }
Â  Â  Â  Â  .color-dot { width: 10px; height: 10px; border-radius: 50%; position: absolute; bottom: 2px; right: 2px; border: 1px solid #fff; }

Â  Â  Â  Â  /* çµæœé¢æ¿ */
Â  Â  Â  Â  #result-panel {
Â  Â  Â  Â  Â  Â  position: absolute; right: 0; top: 0; width: 40%; height: 100%; background: #fff;
Â  Â  Â  Â  Â  Â  transform: translateX(100%); transition: transform 0.8s ease; color: #333;
Â  Â  Â  Â  Â  Â  padding: 50px; box-sizing: border-box; overflow-y: auto; display: flex; flex-direction: column;
Â  Â  Â  Â  }
Â  Â  Â  Â  body.result-mode #result-panel { transform: translateX(0); }
Â  Â  Â  Â  .crystal-name { font-size: 2.5rem; font-weight: bold; margin-bottom: 10px; }
Â  Â  Â  Â  .crystal-theme { color: var(--gold); font-family: 'Allura', cursive; font-size: 2rem; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* RWD */
Â  Â  Â  Â  @media (max-width: 768px) {
Â  Â  Â  Â  Â  Â  body.result-mode #canvas-wrapper { width: 100%; height: 40vh; }
Â  Â  Â  Â  Â  Â  #result-panel { width: 100%; height: 60vh; top: auto; bottom: 0; transform: translateY(100%); }
Â  Â  Â  Â  Â  Â  body.result-mode #result-panel { transform: translateY(0); }
Â  Â  Â  Â  Â  Â  #center-stage { width: 90%; }
Â  Â  Â  Â  Â  Â  #wolf-canvas { width: 120px; height: 120px; }
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>
Â  Â  <audio id="bgm" loop>
Â  Â  Â  Â  <source src="./music/bgm.mp3" type="audio/mpeg">
Â  Â  </audio>

Â  Â  <div id="canvas-wrapper"></div>

Â  Â  <div id="ui-layer">
Â  Â  Â  Â  <div class="top-bar pointer-auto">
Â  Â  Â  Â  Â  Â  <div class="logo">Crystal & Wolf</div>
Â  Â  Â  Â  Â  Â  <button class="audio-btn" onclick="toggleAudio()">ğŸµ Music: OFF</button>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="loading-screen">
Â  Â  Â  Â  Â  Â  <h3>æ­£åœ¨å‡èšæ˜Ÿé›²...</h3>
Â  Â  Â  Â  Â  Â  <div id="loading-text">0%</div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="center-stage" class="pointer-auto" style="display:none;">
Â  Â  Â  Â  Â  Â  <div id="reward-toast">ç²å¾—æ–°é…ä»¶ï¼âœ¨</div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <canvas id="wolf-canvas" width="64" height="64" title="é»æ“Šæ›è£"></canvas>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <button class="cta-button" onclick="startJourney()">
Â  Â  Â  Â  Â  Â  Â  Â  <span>âœ¦ ä»Šå¤©è¦å°ˆæ³¨åœ¨ä»€éº¼å±¤é¢ï¼Ÿ</span>
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <button class="wardrobe-btn" onclick="openWardrobe()">ğŸ’ æ‰“é–‹è¡£æ«ƒ (æ”¶è—: <span id="collection-count">0</span>)</button>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="result-panel" class="pointer-auto">
Â  Â  Â  Â  Â  Â  <div id="panel-content"></div>
Â  Â  Â  Â  Â  Â  <button class="cta-button" style="margin-top:auto; width:100%; justify-content:center;" onclick="resetApp()">å†æŠ½ä¸€å¼µ</button>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="wardrobe-modal">
Â  Â  Â  Â  <div class="wardrobe-content pointer-auto">
Â  Â  Â  Â  Â  Â  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
Â  Â  Â  Â  Â  Â  Â  Â  <h3 style="margin:0;">å°ç‹¼çš„è¡£æ«ƒ</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="closeWardrobe()" style="background:none; border:none; color:#fff; cursor:pointer;">âœ•</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="wardrobe-tabs" id="wardrobe-tabs">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="wardrobe-grid" id="wardrobe-grid">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <script>

Â  Â  Â  Â  function updateLoading(loaded, total) {
Â  Â  const percent = Math.floor((loaded / total) * 100);
Â  Â  const text = document.getElementById('loading-text');
Â  Â  if (text) text.innerText = `${percent}%`;

Â  Â  if (loaded >= total) {
Â  Â  Â  Â  const loading = document.getElementById('loading-screen');
Â  Â  Â  Â  if (loading) loading.style.opacity = 0;

Â  Â  Â  Â  const stage = document.getElementById('center-stage');
Â  Â  Â  Â  stage.style.display = 'flex';
Â  Â  Â  Â  setTimeout(() => stage.style.opacity = 1, 300);
Â  Â  }
}

Â  Â  Â  Â  // --- å…¨åŸŸè®Šæ•¸ ---
Â  Â  Â  Â  function setupModelInNebula(model, x, y, z, data, index) {
Â  Â  model.position.set(x, y, z);

Â  Â  // ç¸®æ”¾
Â  Â  const scale = 0.5 + Math.random() * 0.5;
Â  Â  model.scale.set(scale, scale, scale);

Â  Â  model.userData = { index, data };
Â  Â  crystals.push(model);
Â  Â  nebulaGroup.add(model);
}
Â  Â  Â  Â  let scene, camera, renderer, controls;
Â  Â  Â  Â  let nebulaGroup = new THREE.Group();
Â  Â  Â  Â  let crystals = []; // å­˜æ”¾æ‰€æœ‰ 3D æ°´æ™¶ç‰©ä»¶
Â  Â  Â  Â  let currentCrystal = null; // ç•¶å‰å±•ç¤ºçš„æ°´æ™¶
Â  Â  Â  Â  let isResultMode = false;
Â  Â  Â  Â  let audioPlaying = false;

Â  Â  Â  Â  // å°ç‹¼ç‹€æ…‹
Â  Â  Â  Â  let wolfState = {
Â  Â  Â  Â  Â  Â  hat: { id: 0, color: 0 }, // 0 ä»£è¡¨æ²’ç©¿/åˆå§‹
Â  Â  Â  Â  Â  Â  top: { id: 0, color: 0 },
Â  Â  Â  Â  Â  Â  bottom: { id: 0, color: 0 },
Â  Â  Â  Â  Â  Â  shoes: { id: 0, color: 0 },
Â  Â  Â  Â  Â  Â  float: { id: 0, color: 0 },
Â  Â  Â  Â  Â  Â  inventory: [] // å­˜æ”¾å·²è§£é–çš„é…ä»¶å­—ä¸² "type_id_colorIndex"
Â  Â  Â  Â  };

Â  Â  Â  Â  // --- 1. åˆå§‹åŒ–èˆ‡ 3D å ´æ™¯ ---
Â  Â  Â  Â  function init() {
Â  Â  Â  Â  Â  Â  // Three.js Setup
Â  Â  Â  Â  Â  Â  const container = document.getElementById('canvas-wrapper');
Â  Â  Â  Â  Â  Â  scene = new THREE.Scene();
Â  Â  Â  Â  Â  Â  scene.fog = new THREE.FogExp2(0x050505, 0.02); // éœ§æ°£æ•ˆæœ

Â  Â  Â  Â  Â  Â  camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
Â  Â  Â  Â  Â  Â  camera.position.z = 25;

Â  Â  Â  Â  Â  Â  renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
Â  Â  Â  Â  Â  Â  renderer.setSize(window.innerWidth, window.innerHeight);
Â  Â  Â  Â  Â  Â  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2)); // æ•ˆèƒ½å„ªåŒ–
Â  Â  Â  Â  Â  Â  renderer.toneMapping = THREE.ACESFilmicToneMapping;
Â  Â  Â  Â  Â  Â  renderer.outputEncoding = THREE.sRGBEncoding;
Â  Â  Â  Â  Â  Â  container.appendChild(renderer.domElement);

Â  Â  Â  Â  Â  Â  // ç‡ˆå…‰
Â  Â  Â  Â  Â  Â  const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
Â  Â  Â  Â  Â  Â  scene.add(ambientLight);
Â  Â  Â  Â  Â  Â  const dirLight = new THREE.DirectionalLight(0xffffff, 1.5);
Â  Â  Â  Â  Â  Â  dirLight.position.set(10, 20, 10);
Â  Â  Â  Â  Â  Â  scene.add(dirLight);
Â  Â  Â  Â  Â  Â  const pointLight = new THREE.PointLight(0xD4AF37, 2, 50); // é‡‘è‰²é»å…‰
Â  Â  Â  Â  Â  Â  pointLight.position.set(0, 0, 0);
Â  Â  Â  Â  Â  Â  scene.add(pointLight);

Â  Â  Â  Â  Â  Â  // æ§åˆ¶å™¨
Â  Â  Â  Â  Â  Â  controls = new THREE.OrbitControls(camera, renderer.domElement);
Â  Â  Â  Â  Â  Â  controls.enableDamping = true;
Â  Â  Â  Â  Â  Â  controls.dampingFactor = 0.05;
Â  Â  Â  Â  Â  Â  controls.autoRotate = true;
Â  Â  Â  Â  Â  Â  controls.autoRotateSpeed = 0.5;
Â  Â  Â  Â  Â  Â  controls.enableZoom = true;
Â  Â  Â  Â  Â  Â  controls.maxDistance = 60;
Â  Â  Â  Â  Â  Â  controls.minDistance = 5;

Â  Â  Â  Â  Â  Â  // è¼‰å…¥æ°´æ™¶æ˜Ÿé›²
Â  Â  Â  Â  Â  Â  loadCrystalsNebula();

Â  Â  Â  Â  Â  Â  // åˆå§‹åŒ–å°ç‹¼ç³»çµ±
Â  Â  Â  Â  Â  Â  initWolfSystem();
Â  Â  Â  Â  Â  Â  checkDailyReward();

Â  Â  Â  Â  Â  Â  // å‹•ç•«å¾ªç’°
Â  Â  Â  Â  Â  Â  animate();
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  window.addEventListener('resize', onWindowResize);
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- 2. è¼‰å…¥æ°´æ™¶æ˜Ÿé›² (GLTF + Draco) ---
function loadCrystalsNebula() {
Â  Â  const dracoLoader = new THREE.DRACOLoader();
Â  Â Â 
Â  Â  // --- é—œéµä¿®æ­£ï¼šä½¿ç”¨ Google è¨—ç®¡çš„ Draco è§£ç¢¼å™¨è·¯å¾‘ ---
Â  Â  // é€™è£¡å¿…é ˆæŒ‡å‘åŒ…å« .js å’Œ .wasm æª”æ¡ˆçš„è³‡æ–™å¤¾
Â  Â  dracoLoader.setDecoderPath('https://www.gstatic.com/draco/versioned/decoders/1.4.3/');

Â  Â  const loader = new THREE.GLTFLoader();
Â  Â  loader.setDRACOLoader(dracoLoader);

Â  Â  let loadedCount = 0;
Â  Â  const crystalsArray = Object.values(window.crystalsData);
Â  Â  const total = crystalsArray.length;
Â  Â Â 
Â  Â  console.log(`é–‹å§‹è§£ç¢¼ä¸¦è¼‰å…¥ ${total} é¡†æ°´æ™¶...`);

Â  Â  // é€™è£¡å»ºè­°å…ˆå°‡ Object è½‰ç‚º Array è™•ç† (å¦‚æœ crystalsData æ˜¯ç‰©ä»¶æ ¼å¼)
Â  Â  const dataEntries = Object.entries(window.crystalsData);

Â  Â  dataEntries.forEach(([key, data]) => {
Â  Â  Â  Â  const index = parseInt(key);
Â  Â  Â  Â  const radius = 10 + Math.random() * 15;
Â  Â  Â  Â  const theta = Math.random() * Math.PI * 2;
Â  Â  Â  Â  const phi = Math.acos((Math.random() * 2) - 1);
Â  Â  Â  Â Â 
Â  Â  Â  Â  const x = radius * Math.sin(phi) * Math.cos(theta);
Â  Â  Â  Â  const y = radius * Math.sin(phi) * Math.sin(theta);
Â  Â  Â  Â  const z = radius * Math.cos(phi);

Â  Â  Â  Â  const filename = data.modelFile || 'default.glb';
Â  Â  Â  Â  const path = `./models/${filename}`;
Â  Â  Â  Â Â 
Â  Â  Â  Â  loader.load(path, (gltf) => {
Â  Â  Â  Â  Â  Â  const model = gltf.scene;
Â  Â  Â  Â  Â  Â  setupModelInNebula(model, x, y, z, data, index);Â 
Â  Â  Â  Â  Â  Â  loadedCount++;
Â  Â  Â  Â  Â  Â  updateLoading(loadedCount, total);
Â  Â  Â  Â  }, undefined, (err) => {
Â  Â  Â  Â  Â  Â  console.warn(`[è·³é] ç„¡æ³•è¼‰å…¥æˆ–è§£ç¢¼æ¨¡å‹: ${filename}ï¼Œé€™å¯èƒ½æ˜¯è·¯å¾‘æˆ–æ ¼å¼å•é¡Œã€‚`, err);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // å³ä½¿å‡ºéŒ¯ä¹Ÿç•«ä¸€å€‹å°æ–¹å¡Šä»£æ›¿ï¼Œç¢ºä¿é€²åº¦æ¢æœƒå‹•
Â  Â  Â  Â  Â  Â  const geo = new THREE.BoxGeometry(0.3, 0.3, 0.3);
Â  Â  Â  Â  Â  Â  const mat = new THREE.MeshStandardMaterial({ color: 0x444444 });
Â  Â  Â  Â  Â  Â  const mesh = new THREE.Mesh(geo, mat);
Â  Â  Â  Â  Â  Â  setupModelInNebula(mesh, x, y, z, data, index);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  loadedCount++;
Â  Â  Â  Â  Â  Â  updateLoading(loadedCount, total);
Â  Â  Â  Â  });
Â  Â  });
Â  Â Â 
Â  Â  scene.add(nebulaGroup);
}
Â  Â  Â  Â  // --- 3. å°ç‹¼é¤Šæˆç³»çµ± (Canvas) ---
Â  Â  Â  Â Â 
Â  Â  Â  Â  function initWolfSystem() {
Â  Â  Â  Â  Â  Â  // è®€å–å­˜æª”
Â  Â  Â  Â  Â  Â  const savedData = localStorage.getItem('wolfData');
Â  Â  Â  Â  Â  Â  if (savedData) {
Â  Â  Â  Â  Â  Â  Â  Â  const parsed = JSON.parse(savedData);
Â  Â  Â  Â  Â  Â  Â  Â  wolfState.inventory = parsed.inventory || [];
Â  Â  Â  Â  Â  Â  Â  Â  // æ¢å¾©ä¸Šæ¬¡ç©¿è‘— (å¦‚æœæœ‰)
Â  Â  Â  Â  Â  Â  Â  Â  if(parsed.wearing) Object.assign(wolfState, parsed.wearing);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  // åˆå§‹è´ˆé€ä¸€äº›åŸºæœ¬æ¬¾
Â  Â  Â  Â  Â  Â  Â  Â  wolfState.inventory = ['top_1_0', 'bottom_1_0'];
Â  Â  Â  Â  Â  Â  Â  Â  wolfState.top = { id: 1, color: 0 };
Â  Â  Â  Â  Â  Â  Â  Â  wolfState.bottom = { id: 1, color: 0 };
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  updateCollectionCount();
Â  Â  Â  Â  Â  Â  drawWolf();
Â  Â  Â  Â  }

Â  Â  Â  Â  function checkDailyReward() {
Â  Â  Â  Â  Â  Â  const lastDraw = localStorage.getItem('lastDrawDate');
Â  Â  Â  Â  Â  Â  const today = new Date().toDateString();

Â  Â  Â  Â  Â  Â  if (lastDraw !== today) {
Â  Â  Â  Â  Â  Â  Â  Â  // æ˜¯æ–°çš„ä¸€å¤©ï¼Œç™¼æ”¾çå‹µ
Â  Â  Â  Â  Â  Â  Â  Â  giveRandomItem();
Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('lastDrawDate', today);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // é¡¯ç¤ºå‹•ç•«
Â  Â  Â  Â  Â  Â  Â  Â  const toast = document.getElementById('reward-toast');
Â  Â  Â  Â  Â  Â  Â  Â  toast.classList.add('show');
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => toast.classList.remove('show'), 3000);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function giveRandomItem() {
Â  Â  Â  Â  Â  Â  // å¾æ‰€æœ‰çµ„åˆä¸­éš¨æ©ŸæŠ½å–
Â  Â  Â  Â  Â  Â  const types = ['hat', 'top', 'bottom', 'shoes', 'float'];
Â  Â  Â  Â  Â  Â  const type = types[Math.floor(Math.random() * types.length)];
Â  Â  Â  Â  Â  Â  const count = window.wolfParts[type].count;
Â  Â  Â  Â  Â  Â  const styleId = Math.floor(Math.random() * count) + 1; // 1~6
Â  Â  Â  Â  Â  Â  const colorIdx = Math.floor(Math.random() * window.wolfColors.length); // 0~9
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const itemKey = `${type}_${styleId}_${colorIdx}`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (!wolfState.inventory.includes(itemKey)) {
Â  Â  Â  Â  Â  Â  Â  Â  wolfState.inventory.push(itemKey);
Â  Â  Â  Â  Â  Â  Â  Â  saveWolfData();
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('reward-toast').innerText = `ç²å¾—æ–°è£å‚™ï¼š${window.wolfColors[colorIdx].name}${window.wolfParts[type].label}ï¼âœ¨`;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  // å¦‚æœé‡è¤‡ï¼Œç°¡å–®é‡è©¦ä¸€æ¬¡æˆ–è€…ç®—é‹æ°£ä¸å¥½ (é€™è£¡ç‚ºäº†æ¼”ç¤ºï¼Œæˆ‘å€‘å…è¨±é‡è¤‡ä½†ä¸å¢åŠ )
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('reward-toast').innerText = `ä»Šå¤©æ²’æœ‰ç™¼ç¾æ–°æ±è¥¿...`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function saveWolfData() {
Â  Â  Â  Â  Â  Â  const dataToSave = {
Â  Â  Â  Â  Â  Â  Â  Â  inventory: wolfState.inventory,
Â  Â  Â  Â  Â  Â  Â  Â  wearing: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hat: wolfState.hat,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  top: wolfState.top,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bottom: wolfState.bottom,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shoes: wolfState.shoes,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  float: wolfState.float
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  localStorage.setItem('wolfData', JSON.stringify(dataToSave));
Â  Â  Â  Â  Â  Â  updateCollectionCount();
Â  Â  Â  Â  }

Â  Â  Â  Â  function updateCollectionCount() {
Â  Â  Â  Â  Â  Â  document.getElementById('collection-count').innerText = wolfState.inventory.length;
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- æ ¸å¿ƒï¼šç¹ªè£½å°ç‹¼ ---
Â  Â  Â  Â  function drawWolf() {
Â  Â  Â  Â  Â  Â  const canvas = document.getElementById('wolf-canvas');
Â  Â  Â  Â  Â  Â  const ctx = canvas.getContext('2d');
Â  Â  Â  Â  Â  Â  ctx.clearRect(0, 0, 64, 64);

Â  Â  Â  Â  Â  Â  // ç¹ªåœ–é †åºï¼šç´ é«” -> è¤²å­ -> é‹å­ -> ä¸Šè¡£ -> å¸½å­ -> æ¼‚æµ®ç‰©
Â  Â  Â  Â  Â  Â  // é€™è£¡ä½¿ç”¨ "ç¨‹å¼ç¢¼ç¹ªåœ–" ä½œç‚º fallbackï¼Œå¦‚æœæ‚¨æœ‰åœ–ç‰‡ï¼Œè«‹ç”¨ Image ç‰©ä»¶è¼‰å…¥
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  drawLayer(ctx, 'base', {id:1}, 0); // ç´ é«”
Â  Â  Â  Â  Â  Â  drawLayer(ctx, 'bottom', wolfState.bottom, 1);
Â  Â  Â  Â  Â  Â  drawLayer(ctx, 'shoes', wolfState.shoes, 1); // ç°¡åŒ–
Â  Â  Â  Â  Â  Â  drawLayer(ctx, 'top', wolfState.top, 1);
Â  Â  Â  Â  Â  Â  drawLayer(ctx, 'hat', wolfState.hat, 1);
Â  Â  Â  Â  Â  Â  drawLayer(ctx, 'float', wolfState.float, 1);
Â  Â  Â  Â  }

Â  Â  Â  Â  // æ¨¡æ“¬è¼‰å…¥åœ–ç‰‡èˆ‡æŸ“è‰² (è‹¥ç„¡åœ–ç‰‡å‰‡ç•«è‰²å¡Š)
Â  Â  Â  Â  function drawLayer(ctx, type, item, scale) {
Â  Â  Â  Â  Â  Â  if (!item || item.id === 0) return;

Â  Â  Â  Â  Â  Â  const colorHex = (type === 'base') ? '#999' : window.wolfColors[item.color].hex;
Â  Â  Â  Â  Â  Â  ctx.fillStyle = colorHex;

Â  Â  Â  Â  Â  Â  // --- é€™è£¡æ˜¯ç”¨ç¨‹å¼ç¢¼ç•«å‡åƒç´  ---
Â  Â  Â  Â  Â  Â  // å¦‚æœæ‚¨æœ‰åœ–ç‰‡ï¼Œè«‹æŠŠé€™è£¡æ”¹æˆ load image -> drawImage
Â  Â  Â  Â  Â  Â  // ç‚ºäº†ç¤ºç¯„ï¼Œæˆ‘ç•«ç°¡å–®çš„çŸ©å½¢ä»£è¡¨ä¸åŒéƒ¨ä½
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (type === 'base') {
Â  Â  Â  Â  Â  Â  Â  Â  // ç•«ä¸€å€‹ç°¡å–®çš„ç‹¼å½¢ç‹€
Â  Â  Â  Â  Â  Â  Â  Â  ctx.fillStyle = '#ccc'; ctx.fillRect(20, 20, 24, 30); // èº«é«”
Â  Â  Â  Â  Â  Â  Â  Â  ctx.fillRect(22, 10, 20, 10); // é ­
Â  Â  Â  Â  Â  Â  Â  Â  ctx.fillStyle = '#333'; ctx.fillRect(25, 14, 2, 2); ctx.fillRect(37, 14, 2, 2); // çœ¼ç›
Â  Â  Â  Â  Â  Â  Â  Â  ctx.fillStyle = '#ccc'; ctx.fillRect(18, 5, 4, 6); ctx.fillRect(42, 5, 4, 6); // è€³æœµ
Â  Â  Â  Â  Â  Â  Â  Â  ctx.fillRect(20, 50, 8, 10); ctx.fillRect(36, 50, 8, 10); // è…³
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  else if (type === 'top') {
Â  Â  Â  Â  Â  Â  Â  Â  Â // ä¸Šè¡£éš¨æ¬¾å¼è®ŠåŒ–ä¸€é»å½¢ç‹€
Â  Â  Â  Â  Â  Â  Â  Â  Â ctx.fillRect(18, 20, 28, 18);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â if(item.id > 3) ctx.fillRect(16, 20, 32, 5); // å¯¬è‚©æ¬¾
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  else if (type === 'bottom') {
Â  Â  Â  Â  Â  Â  Â  Â  Â ctx.fillRect(20, 38, 24, 12);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  else if (type === 'hat') {
Â  Â  Â  Â  Â  Â  Â  Â  Â ctx.fillRect(20, 4, 24, 6); // å¸½ç°·
Â  Â  Â  Â  Â  Â  Â  Â  Â ctx.fillRect(22, 0, 20, 4); // å¸½é ‚
Â  Â  Â  Â  Â  Â  Â  Â  Â if(item.id === 6) { ctx.fillStyle="#FFD700"; ctx.fillText("ğŸ‘‘", 24, 0); } // ç‰¹æ®Šæ¬¾
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  else if (type === 'shoes') {
Â  Â  Â  Â  Â  Â  Â  Â  Â ctx.fillRect(19, 56, 10, 6); ctx.fillRect(35, 56, 10, 6);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  else if (type === 'float') {
Â  Â  Â  Â  Â  Â  Â  Â  Â const symbols = ["â¤", "!", "â˜…", "â—¡", "zZ", "SOS"];
Â  Â  Â  Â  Â  Â  Â  Â  Â ctx.font = "16px monospace";
Â  Â  Â  Â  Â  Â  Â  Â  Â ctx.fillStyle = colorHex;
Â  Â  Â  Â  Â  Â  Â  Â  Â ctx.fillText(symbols[item.id-1] || "?", 45, 15);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- 4. æŠ½å¡äº’å‹•é‚è¼¯ ---
Â  Â  Â  Â Â 
Â  Â  Â  Â  function startJourney() {
Â  Â  ensureAudio();

Â  Â  document.getElementById('center-stage').style.opacity = 0;
Â  Â  setTimeout(() => {
Â  Â  Â  Â  document.getElementById('center-stage').style.display = 'none';
Â  Â  }, 500);

Â  Â  const crystalsArray = Object.values(window.crystalsData);
Â  Â  const randomIndex = Math.floor(Math.random() * crystalsArray.length);
Â  Â  const data = crystalsArray[randomIndex];

Â  Â  scene.remove(nebulaGroup);

Â  Â  const dracoLoader = new THREE.DRACOLoader();
Â  Â  dracoLoader.setDecoderPath(
Â  Â  Â  'https://www.gstatic.com/draco/versioned/decoders/1.4.3/'
Â  Â  );

Â  Â  const loader = new THREE.GLTFLoader();
Â  Â  loader.setDRACOLoader(dracoLoader);

Â  Â  const path = `./models/${data.modelFile}`;
Â  Â  loader.load(path, (gltf) => {
Â  Â  Â  Â  showResult(gltf.scene, data);
Â  Â  }, undefined, () => {
Â  Â  Â  Â  const geo = new THREE.IcosahedronGeometry(2, 0);
Â  Â  Â  Â  const mat = new THREE.MeshStandardMaterial({ color: 0x88ccff });
Â  Â  Â  Â  showResult(new THREE.Mesh(geo, mat), data);
Â  Â  });
}


Â  Â  Â  Â  function showResult(model, data) {
Â  Â  Â  Â  Â  Â  isResultMode = true;
Â  Â  Â  Â  Â  Â  document.body.classList.add('result-mode');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if(currentCrystal) scene.remove(currentCrystal);
Â  Â  Â  Â  Â  Â  currentCrystal = model;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // èª¿æ•´å¤§å°èˆ‡ä½ç½®
Â  Â  Â  Â  Â  Â  const box = new THREE.Box3().setFromObject(currentCrystal);
Â  Â  Â  Â  Â  Â  const size = new THREE.Vector3();
Â  Â  Â  Â  Â  Â  box.getSize(size);
Â  Â  Â  Â  Â  Â  const max = Math.max(size.x, size.y, size.z);
Â  Â  Â  Â  Â  Â  const scale = 5 / max;
Â  Â  Â  Â  Â  Â  currentCrystal.scale.set(scale, scale, scale);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // RWD ä½ç½®
Â  Â  Â  Â  Â  Â  if(window.innerWidth > 768) {
Â  Â  Â  Â  Â  Â  Â  Â  currentCrystal.position.set(-3, 0, 0);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  currentCrystal.position.set(0, 1, 0);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  scene.add(currentCrystal);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // æ›´æ–°æ–‡å­—é¢æ¿
Â  Â  Â  Â  Â  Â  const panel = document.getElementById('panel-content');
Â  Â  Â  Â  Â  Â  panel.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="crystal-header">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="crystal-theme">${data.theme}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="crystal-name">${data.name}</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <p>${data.message}</p>
Â  Â  Â  Â  Â  Â  Â  Â  <hr style="border-color:var(--gold); opacity:0.3; margin: 20px 0;">
Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>å•å•è‡ªå·±ï¼š</strong><br>${data.question}</p>
Â  Â  Â  Â  Â  Â  Â  Â  <div style="background:#f9f9f9; padding:15px; border-left:4px solid var(--gold); margin-top:20px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <em>${data.action}</em>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <p style="font-size:0.9rem; color:#666; margin-top:10px;">${data.subAction}</p>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // æ”å½±æ©Ÿå‹•ç•«
Â  Â  Â  Â  Â  Â  camera.position.set(0, 0, 15);
Â  Â  Â  Â  }

Â  Â  Â  Â  function resetApp() {
Â  Â  Â  Â  Â  Â  isResultMode = false;
Â  Â  Â  Â  Â  Â  document.body.classList.remove('result-mode');
Â  Â  Â  Â  Â  Â  if(currentCrystal) scene.remove(currentCrystal);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  scene.add(nebulaGroup);
Â  Â  Â  Â  Â  Â  camera.position.set(0, 0, 25);
Â  Â  Â  Â  Â  Â  controls.autoRotate = true;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const stage = document.getElementById('center-stage');
Â  Â  Â  Â  Â  Â  stage.style.display = 'flex';
Â  Â  Â  Â  Â  Â  setTimeout(() => { stage.style.opacity = 1; }, 100);
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- 5. è¡£æ«ƒ UI é‚è¼¯ ---
Â  Â  Â  Â  function openWardrobe() {
Â  Â  Â  Â  Â  Â  const modal = document.getElementById('wardrobe-modal');
Â  Â  Â  Â  Â  Â  modal.style.display = 'flex';
Â  Â  Â  Â  Â  Â  renderTabs();
Â  Â  Â  Â  Â  Â  renderGrid('hat'); // é è¨­é¡¯ç¤ºå¸½å­
Â  Â  Â  Â  }

Â  Â  Â  Â  function closeWardrobe() {
Â  Â  Â  Â  Â  Â  document.getElementById('wardrobe-modal').style.display = 'none';
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderTabs() {
Â  Â  Â  Â  Â  Â  const tabs = document.getElementById('wardrobe-tabs');
Â  Â  Â  Â  Â  Â  tabs.innerHTML = '';
Â  Â  Â  Â  Â  Â  Object.keys(window.wolfParts).forEach(key => {
Â  Â  Â  Â  Â  Â  Â  Â  const btn = document.createElement('button');
Â  Â  Â  Â  Â  Â  Â  Â  btn.className = 'tab-btn';
Â  Â  Â  Â  Â  Â  Â  Â  btn.innerText = window.wolfParts[key].label;
Â  Â  Â  Â  Â  Â  Â  Â  btn.onclick = (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.target.classList.add('active');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderGrid(key);
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  tabs.appendChild(btn);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  tabs.children[0].classList.add('active');
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderGrid(type) {
Â  Â  Â  Â  Â  Â  const grid = document.getElementById('wardrobe-grid');
Â  Â  Â  Â  Â  Â  grid.innerHTML = '';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ç”Ÿæˆè©²é¡åˆ¥çš„æ‰€æœ‰å¯èƒ½çµ„åˆ (6æ¬¾ * 10è‰²)
Â  Â  Â  Â  Â  Â  const partInfo = window.wolfParts[type];
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // å…ˆåŠ å…¥ã€Œè„«ä¸‹ã€é¸é …
Â  Â  Â  Â  Â  Â  const removeBtn = document.createElement('div');
Â  Â  Â  Â  Â  Â  removeBtn.className = 'wardrobe-item';
Â  Â  Â  Â  Â  Â  removeBtn.innerText = "âŒ";
Â  Â  Â  Â  Â  Â  removeBtn.onclick = () => {
Â  Â  Â  Â  Â  Â  Â  Â  wolfState[type] = { id: 0, color: 0 };
Â  Â  Â  Â  Â  Â  Â  Â  saveWolfData();
Â  Â  Â  Â  Â  Â  Â  Â  drawWolf();
Â  Â  Â  Â  Â  Â  Â  Â  renderGrid(type);
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  grid.appendChild(removeBtn);

Â  Â  Â  Â  Â  Â  for(let i=1; i<=partInfo.count; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  window.wolfColors.forEach((color, colorIdx) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const itemKey = `${type}_${i}_${colorIdx}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isUnlocked = wolfState.inventory.includes(itemKey);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const div = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  div.className = `wardrobe-item ${isUnlocked ? '' : 'locked'}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // å¦‚æœæ­£åœ¨ç©¿è‘—
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(wolfState[type].id === i && wolfState[type].color === colorIdx) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  div.classList.add('active');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // è¦–è¦ºå‘ˆç¾ (è‰²é» + ID)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  div.innerHTML = `<span style="font-size:0.6rem; color:#fff;">${i}</span>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dot = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dot.className = 'color-dot';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dot.style.backgroundColor = color.hex;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  div.appendChild(dot);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(isUnlocked) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  div.onclick = () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  wolfState[type] = { id: i, color: colorIdx };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  saveWolfData();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  drawWolf(); // æ›´æ–°å°ç‹¼é¡¯ç¤º
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderGrid(type); // æ›´æ–°é¸ä¸­ç‹€æ…‹
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  grid.appendChild(div);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- 6. éŸ³æ¨‚æ§åˆ¶ ---
Â  Â  Â  Â  function toggleAudio() {
Â  Â  Â  Â  Â  Â  const audio = document.getElementById('bgm');
Â  Â  Â  Â  Â  Â  const btn = document.querySelector('.audio-btn');
Â  Â  Â  Â  Â  Â  if(audio.paused) {
Â  Â  Â  Â  Â  Â  Â  Â  audio.play();
Â  Â  Â  Â  Â  Â  Â  Â  audioPlaying = true;
Â  Â  Â  Â  Â  Â  Â  Â  btn.innerText = "ğŸµ Music: ON";
Â  Â  Â  Â  Â  Â  Â  Â  btn.style.borderColor = "#fff";
Â  Â  Â  Â  Â  Â  Â  Â  btn.style.color = "#fff";
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  audio.pause();
Â  Â  Â  Â  Â  Â  Â  Â  audioPlaying = false;
Â  Â  Â  Â  Â  Â  Â  Â  btn.innerText = "ğŸµ Music: OFF";
Â  Â  Â  Â  Â  Â  Â  Â  btn.style.borderColor = "var(--gold)";
Â  Â  Â  Â  Â  Â  Â  Â  btn.style.color = "var(--gold)";
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function ensureAudio() {
Â  Â  Â  Â  Â  Â  // ç”¨æˆ¶äº’å‹•å¾Œå˜—è©¦æ’­æ”¾ (å¦‚æœä¹‹å‰æ²’é–‹çš„è©±)
Â  Â  Â  Â  Â  Â  if(!audioPlaying) {
Â  Â  Â  Â  Â  Â  Â  Â  Â // é€™è£¡å¯ä»¥é¸æ“‡å¼·åˆ¶é–‹å•Ÿï¼Œæˆ–è€…å°Šé‡ç”¨æˆ¶é¸æ“‡ã€‚
Â  Â  Â  Â  Â  Â  Â  Â  Â // é€šå¸¸å»ºè­°ä¸è¦åœ¨é»æ“Šå…¶ä»–æŒ‰éˆ•æ™‚å¼·åˆ¶æ’­æ”¾ï¼Œé™¤éæ˜¯ç”¨æˆ¶æ˜ç¢ºé»æ“Šäº† Playã€‚
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- 7. å…¶ä»– ---
Â  Â  Â  Â  function onWindowResize() {
Â  Â  Â  Â  Â  Â  camera.aspect = window.innerWidth / window.innerHeight;
Â  Â  Â  Â  Â  Â  camera.updateProjectionMatrix();
Â  Â  Â  Â  Â  Â  renderer.setSize(window.innerWidth, window.innerHeight);
Â  Â  Â  Â  }

Â  Â  Â  Â  function animate() {
Â  Â  Â  Â  Â  Â  requestAnimationFrame(animate);
Â  Â  Â  Â  Â  Â  controls.update();
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if(!isResultMode) {
Â  Â  Â  Â  Â  Â  Â  Â  // æ˜Ÿé›²è‡ªè½‰
Â  Â  Â  Â  Â  Â  Â  Â  nebulaGroup.rotation.y += 0.001;
Â  Â  Â  Â  Â  Â  Â  Â  // æ°´æ™¶è‡ªè½‰
Â  Â  Â  Â  Â  Â  Â  Â  crystals.forEach(c => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  c.rotation.x += 0.005;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  c.rotation.y += 0.005;
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  } else if(currentCrystal) {
Â  Â  Â  Â  Â  Â  Â  Â  currentCrystal.rotation.y += 0.002;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  renderer.render(scene, camera);
Â  Â  Â  Â  }

Â  Â  Â  Â  // å•Ÿå‹•
Â  Â  Â  Â  init();

Â  Â  </script>
</body>
</html>
