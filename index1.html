<!-- ========== index.html — PART 1/5 (HEAD + CSS + PAGE CONTAINER) ========== -->
<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Crystal & Wolf — 3D 水晶展示</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Allura&family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,400&display=swap" rel="stylesheet">

  <!-- three.js core + loaders + controls (r128 compatible) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/DRACOLoader.js"></script>

  <!-- SimplexNoise for procedural detail (used later) -->
  <script src="https://cdn.jsdelivr.net/npm/simplex-noise@2.4.0/simplex-noise.min.js"></script>

  <style>
    :root{
      --gold: #D4AF37;
      --bg-dark: #050505;
      --panel-bg: #ffffff;
      --text-main: #222;
    }
    html,body{height:100%;margin:0;background:var(--bg-dark);font-family:"Cormorant Garamond",serif;color:var(--text-main);-webkit-font-smoothing:antialiased}
    /* background gradient */
    #bg-gradient{position:fixed;inset:0;background:radial-gradient(circle at center,#121212 0%,#040404 60%);z-index:0}

    /* canvas area */
    #canvas-wrapper{position:fixed;inset:0;z-index:1;display:block;overflow:hidden}
    canvas{display:block}

    /* UI overlay */
    .top-bar{position:fixed;left:0;right:0;top:0;height:72px;display:flex;align-items:center;justify-content:space-between;padding:16px 28px;z-index:30;pointer-events:auto}
    .logo{font-family:'Allura',cursive;color:#fff;font-size:30px;letter-spacing:1px;text-shadow:0 2px 10px rgba(0,0,0,0.6)}
    #music-control{color:rgba(255,255,255,0.7);padding:8px 12px;border-radius:6px;border:1px solid rgba(255,255,255,0.08);cursor:pointer;font-size:13px}

    /* center CTA (initial screen) */
    #landing-content{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);z-index:28;text-align:center;pointer-events:auto}
    .cta-button{background:rgba(0,0,0,0.45);border:1px solid var(--gold);color:var(--gold);padding:14px 36px;font-size:18px;border-radius:10px;cursor:pointer;backdrop-filter:blur(4px)}
    .cta-button:hover{transform:translateY(-3px);transition:.18s}

    /* right-side result panel */
    #result-panel{position:fixed;right:0;top:0;height:100%;width:38%;max-width:520px;background:var(--panel-bg);box-shadow:-12px 0 50px rgba(0,0,0,0.5);transform:translateX(100%);transition:transform .6s cubic-bezier(.2,.9,.2,1);z-index:40;overflow:auto;padding:40px;box-sizing:border-box}
    body.result-mode #result-panel{transform:translateX(0)}
    #panel-content{color:#222}

    /* responsive tweaks */
    @media (max-width: 900px){
      #result-panel{width:100%;height:50vh;bottom:0;top:auto;right:0;border-radius:18px 18px 0 0;padding:22px;transform:translateY(100%)}
      body.result-mode #result-panel{transform:translateY(0)}
      body.result-mode #canvas-wrapper{height:50vh}
      .top-bar{padding:12px 16px}
      .logo{font-size:22px}
    }

    /* small helper */
    .hint-overlay{position:fixed;left:50%;transform:translateX(-50%);bottom:28px;color:rgba(255,255,255,0.55);font-size:13px;z-index:29}
  </style>
</head>
<body>
  <div id="bg-gradient"></div>

  <!-- audio (optional) -->
  <audio id="bg-music" loop preload="none">
    <source src="" type="audio/mpeg">
  </audio>

  <!-- page UI -->
  <div class="top-bar">
    <div class="logo">Crystal & Wolf</div>
    <div id="music-control" onclick="toggleMusic()">Music</div>
  </div>

  <div id="landing-content">
    <button class="cta-button" onclick="startJourney()">我今天要專注在什麼事情上？</button>
  </div>

  <div id="canvas-wrapper"></div>

  <div class="hint-overlay">拖曳或滑動以旋轉水晶 · 捏合縮放</div>

  <div id="result-panel">
    <div id="panel-content"></div>
    <button class="retry-btn" style="margin-top:18px;background:transparent;border:none;color:#666;cursor:pointer" onclick="resetApp()">再抽一張卡</button>
  </div>

  <!-- ====== 插入 PART 2/5 - Three.js 初始化程式碼 (接在此處) ====== -->
  <!-- 下一段我會從 Three.js 的 renderer/camera/lights 開始，請接在此標記之後 -->
<!-- ========== index.html — PART 2/5 (Three.js init, loaders, nebula) ========== -->
<script>
/* ========== 基本 Three.js 場景 ========== */
const container = document.getElementById('canvas-wrapper');
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x000000);

// camera
const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 2000);
camera.position.set(0, 0, 30);

// renderer
const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true, preserveDrawingBuffer: false });
renderer.setPixelRatio(Math.min(window.devicePixelRatio || 1, 2));
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.outputEncoding = THREE.sRGBEncoding;
renderer.toneMapping = THREE.ACESFilmicToneMapping;
renderer.toneMappingExposure = 1.0;
container.appendChild(renderer.domElement);

// PMREM generator (for future envMap usage)
const pmremGenerator = new THREE.PMREMGenerator(renderer);
pmremGenerator.compileEquirectangularShader();

// Lights: key + fill + rim
const hemiLight = new THREE.HemisphereLight(0xffffff, 0x222222, 0.35);
scene.add(hemiLight);

const keyLight = new THREE.DirectionalLight(0xffffff, 1.2);
keyLight.position.set(8, 10, 8);
scene.add(keyLight);

const fillLight = new THREE.DirectionalLight(0xffffff, 0.35);
fillLight.position.set(-6, -4, -8);
scene.add(fillLight);

const rimLight = new THREE.SpotLight(0xD4AF37, 2.0, 80, Math.PI / 6, 0.3);
rimLight.position.set(-10, 8, -6);
scene.add(rimLight);

/* ========== Controls ========== */
const controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;
controls.dampingFactor = 0.06;
controls.enablePan = false;
controls.enableZoom = true;
controls.autoRotate = false; // default off; we prefer user drag
controls.autoRotateSpeed = 0.6;

/* subtle mobile behavior */
function isMobile() {
  return /Mobi|Android/i.test(navigator.userAgent);
}
if (isMobile()) {
  controls.enableZoom = true;
  controls.touches = { ONE: THREE.TOUCH.ROTATE, TWO: THREE.TOUCH.DOLLY_PAN };
}

/* ========== Loaders (GLTF + DRACO) ========== */
const dracoLoader = new THREE.DRACOLoader();
// use official draco CDN decoder — fine for GitHub Pages usage
dracoLoader.setDecoderPath('https://www.gstatic.com/draco/v1/decoders/');

const gltfLoader = new THREE.GLTFLoader();
gltfLoader.setDRACOLoader(dracoLoader);

/**
 * loadGLB(url, onLoad, onProgress, onError)
 * returns Promise for convenience
 */
function loadGLB(url, onProgress) {
  return new Promise((resolve, reject) => {
    gltfLoader.load(url, (gltf) => {
      resolve(gltf);
    }, (xhr) => {
      if (onProgress) onProgress(xhr);
    }, (err) => {
      reject(err);
    });
  });
}

/* ========== Helper: standardize materials to MeshPhysicalMaterial ========== */
function normalizeMaterialToPhysical(material) {
  if (material.isMeshStandardMaterial || material.isMeshPhysicalMaterial) {
    const phys = new THREE.MeshPhysicalMaterial();
    phys.copy(material);
    // ensure physical-friendly defaults
    phys.roughness = (material.roughness !== undefined) ? material.roughness : 0.3;
    phys.metalness = (material.metalness !== undefined) ? material.metalness : 0.0;
    phys.transmission = (material.transmission !== undefined) ? material.transmission : 0.0;
    phys.side = THREE.DoubleSide;
    phys.envMapIntensity = 1.0;
    return phys;
  }
  return material;
}

/* ========== Nebula / particle decorative system (lightweight) ========== */
const simplex = new SimplexNoise();
let nebulaGroup = new THREE.Group();
scene.add(nebulaGroup);
let nebulaParticles = [];

function initNebula(dataArray) {
  // clear existing
  while (nebulaGroup.children.length) nebulaGroup.remove(nebulaGroup.children[0]);
  nebulaParticles = [];

  const count = Math.min(48, (dataArray && dataArray.length) ? dataArray.length : 24);
  for (let i = 0; i < count; i++) {
    const geo = new THREE.IcosahedronGeometry(0.18 + Math.random() * 0.25, 0);
    const mat = new THREE.MeshStandardMaterial({
      color: (dataArray && dataArray[i] && dataArray[i].visual) ? dataArray[i].visual.color : 0xffffff,
      roughness: 0.7,
      metalness: 0.0,
      transparent: true,
      opacity: 0.9
    });
    const m = new THREE.Mesh(geo, mat);
    const angle = i * (Math.PI * 2 / count);
    const radius = 3.2 + Math.random() * 6.0;
    m.position.set(Math.cos(angle) * radius, (Math.random() - 0.5) * radius * 0.6, Math.sin(angle) * radius);
    m.rotation.set(Math.random() * Math.PI, Math.random() * Math.PI, Math.random() * Math.PI);
    nebulaGroup.add(m);
    nebulaParticles.push(m);
  }
  nebulaGroup.rotation.x = 0.2;
}

/* ========== Scene helpers ========== */
const gridHelper = null; // hidden by default; you can enable for debugging
let currentModelGroup = null; // holds loaded GLB or procedural crystal group

/* ========== Resize handling ========== */
function onWindowResize() {
  const w = window.innerWidth;
  const h = window.innerHeight;
  camera.aspect = w / h;
  camera.updateProjectionMatrix();
  renderer.setSize(w, h);
}
window.addEventListener('resize', onWindowResize, { passive: true });

/* ========== Interaction tweaks ========== */
let userInteracting = false;
renderer.domElement.addEventListener('pointerdown', () => { userInteracting = true; controls.autoRotate = false; }, { passive: true });
window.addEventListener('pointerup', () => { userInteracting = false; }, { passive: true });

/* ========== Simple animation loop (render only) ========== */
function animate() {
  requestAnimationFrame(animate);
  // nebula rotate
  if (nebulaGroup) nebulaGroup.rotation.y += 0.0025;
  nebulaParticles.forEach((p, i) => { p.rotation.x += 0.01 + i * 0.0001; p.rotation.y += 0.012 + i * 0.0002; });

  // subtle floating for main model
  if (currentModelGroup) {
    currentModelGroup.rotation.y += 0.0035;
    currentModelGroup.position.y += Math.sin(Date.now() * 0.001 + (currentModelGroup.userData.offset || 0)) * 0.002;
  }

  controls.update();
  renderer.render(scene, camera);
}
animate();

/* ========== Start state: will be filled after crystalsData is injected (PART 3) ========== */
initNebula(); // will be re-initialized with actual data when available

/* ========== Expose some functions for UI (defined later) ========== */
function setMainModel(group) {
  if (currentModelGroup) {
    scene.remove(currentModelGroup);
    currentModelGroup.traverse(o => { if (o.geometry) o.geometry.dispose && o.geometry.dispose(); if (o.material) o.material.dispose && o.material.dispose(); });
    currentModelGroup = null;
  }
  currentModelGroup = group;
  if (currentModelGroup) {
    currentModelGroup.userData.offset = Math.random() * Math.PI * 2;
    scene.add(currentModelGroup);
  }
}
</script>
<!-- ====== end PART 2/5 ====== -->
<!-- ========== index.html — PART 3/5 (A) — crystalsData (1–10) ========== -->
<script>
const crystalsData = [
  {
    id: 1,
    name: "Agate",
    zhName: "瑪瑙",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/agate.glb",
    textureUrl: "",
    visual: {
      color: "#B5A89F",
      roughness: 0.35,
      metalness: 0.05,
      transmission: 0.45,
      ior: 1.46,
      thickness: 1.2
    }
  },
  {
    id: 2,
    name: "Amazonite",
    zhName: "天河石",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/amazonite.glb",
    textureUrl: "",
    visual: {
      color: "#6EC8C2",
      roughness: 0.28,
      metalness: 0.02,
      transmission: 0.55,
      ior: 1.49,
      thickness: 1.3
    }
  },
  {
    id: 3,
    name: "Amethyst",
    zhName: "紫水晶",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/amethyst.glb",
    textureUrl: "",
    visual: {
      color: "#9D6EC8",
      roughness: 0.22,
      metalness: 0.03,
      transmission: 0.72,
      ior: 1.53,
      thickness: 1.4
    }
  },
  {
    id: 4,
    name: "Angel_Aura_Quartz",
    zhName: "天使光水晶",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/angel_aura_quartz.glb",
    textureUrl: "",
    visual: {
      color: "#FFFFFF",
      roughness: 0.12,
      metalness: 0.25,
      transmission: 0.9,
      ior: 1.54,
      iridescence: 0.85,
      iridescenceThickness: 480
    }
  },
  {
    id: 5,
    name: "Angelite",
    zhName: "天使石",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/angelite.glb",
    textureUrl: "",
    visual: {
      color: "#AFC6FF",
      roughness: 0.55,
      metalness: 0.0,
      transmission: 0.18,
      ior: 1.47,
      thickness: 0.8
    }
  },
  {
    id: 6,
    name: "Apatite",
    zhName: "磷灰石",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/apatite.glb",
    textureUrl: "",
    visual: {
      color: "#38B5D9",
      roughness: 0.3,
      metalness: 0.02,
      transmission: 0.58,
      ior: 1.50,
      thickness: 1.2
    }
  },
  {
    id: 7,
    name: "Apophyllite",
    zhName: "魚眼石",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/apophyllite.glb",
    textureUrl: "",
    visual: {
      color: "#E2F4FF",
      roughness: 0.18,
      metalness: 0.03,
      transmission: 0.88,
      ior: 1.55,
      dispersion: 0.12
    }
  },
  {
    id: 8,
    name: "Aquamarine",
    zhName: "海水藍寶",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/aquamarine.glb",
    textureUrl: "",
    visual: {
      color: "#8ED4E8",
      roughness: 0.2,
      metalness: 0.0,
      transmission: 0.82,
      ior: 1.56,
      dispersion: 0.09
    }
  },
  {
    id: 9,
    name: "Aragonite",
    zhName: "霰石",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/aragonite.glb",
    textureUrl: "",
    visual: {
      color: "#FFF2D2",
      roughness: 0.42,
      metalness: 0.0,
      transmission: 0.25,
      ior: 1.49,
      thickness: 0.9
    }
  },
  {
    id: 10,
    name: "Aventurine",
    zhName: "東菱石",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/aventurine.glb",
    textureUrl: "",
    visual: {
      color: "#5FA981",
      roughness: 0.38,
      metalness: 0.05,
      transmission: 0.22,
      ior: 1.48,
      glitter: 0.4
    }
  },
  {
    id: 11,
    name: "Azurite",
    zhName: "藍銅礦",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/azurite.glb",
    textureUrl: "",
    visual: {
      color: "#1E3A8A",
      roughness: 0.55,
      metalness: 0.12,
      transmission: 0.12,
      ior: 1.72,
      thickness: 0.6
    }
  },
  {
    id: 12,
    name: "Black_Kyanite",
    zhName: "黑色藍晶石",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/black_kyanite.glb",
    textureUrl: "",
    visual: {
      color: "#1A1A1A",
      roughness: 0.65,
      metalness: 0.08,
      transmission: 0.05,
      ior: 1.70
    }
  },
  {
    id: 13,
    name: "Black_Tourmaline",
    zhName: "黑碧璽",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/black_tourmaline.glb",
    textureUrl: "",
    visual: {
      color: "#0C0C0C",
      roughness: 0.58,
      metalness: 0.1,
      transmission: 0.02,
      ior: 1.61
    }
  },
  {
    id: 14,
    name: "Bloodstone",
    zhName: "血石",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/bloodstone.glb",
    textureUrl: "",
    visual: {
      color: "#213828",
      roughness: 0.48,
      metalness: 0.03,
      transmission: 0.12,
      ior: 1.54,
      inclusions: 0.4
    }
  },
  {
    id: 15,
    name: "Blue_Lace_Agate",
    zhName: "藍紋瑪瑙",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/blue_lace_agate.glb",
    textureUrl: "",
    visual: {
      color: "#A7C8FF",
      roughness: 0.32,
      metalness: 0.02,
      transmission: 0.55,
      ior: 1.47,
      banding: 1.0
    }
  },
  {
    id: 16,
    name: "Carnelian",
    zhName: "紅玉髓",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/carnelian.glb",
    textureUrl: "",
    visual: {
      color: "#C1462E",
      roughness: 0.36,
      metalness: 0.03,
      transmission: 0.35,
      ior: 1.49
    }
  },
  {
    id: 17,
    name: "Celestite",
    zhName: "天青石",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/celestite.glb",
    textureUrl: "",
    visual: {
      color: "#C9DFFF",
      roughness: 0.18,
      metalness: 0.01,
      transmission: 0.75,
      ior: 1.56,
      dispersion: 0.08
    }
  },
  {
    id: 18,
    name: "Chrysocolla",
    zhName: "矽孔雀石",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/chrysocolla.glb",
    textureUrl: "",
    visual: {
      color: "#16A085",
      roughness: 0.52,
      metalness: 0.04,
      transmission: 0.18,
      ior: 1.51
    }
  },
  {
    id: 19,
    name: "Chrysoprase",
    zhName: "綠玉髓",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/chrysoprase.glb",
    textureUrl: "",
    visual: {
      color: "#7EDC8B",
      roughness: 0.35,
      metalness: 0.02,
      transmission: 0.48,
      ior: 1.53,
      thickness: 1.1
    }
  },
  {
    id: 20,
    name: "Citrine",
    zhName: "黃水晶",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/citrine.glb",
    textureUrl: "",
    visual: {
      color: "#F7D26A",
      roughness: 0.22,
      metalness: 0.01,
      transmission: 0.78,
      ior: 1.55,
      dispersion: 0.1
    }
  },
  {
    id: 21,
    name: "Clear_Quartz",
    zhName: "白水晶",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/clear_quartz.glb",
    textureUrl: "",
    visual: {
      color: "#FFFFFF",
      roughness: 0.08,
      metalness: 0.0,
      transmission: 0.95,
      ior: 1.55,
      dispersion: 0.13,
      thickness: 1.8
    }
  },
  {
    id: 22,
    name: "Epidote",
    zhName: "綠簾石",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/epidote.glb",
    textureUrl: "",
    visual: {
      color: "#4B6E41",
      roughness: 0.42,
      metalness: 0.04,
      transmission: 0.22,
      ior: 1.74
    }
  },
  {
    id: 23,
    name: "Fluorite",
    zhName: "螢石",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/fluorite.glb",
    textureUrl: "",
    visual: {
      color: "#9ED3FF",
      roughness: 0.18,
      metalness: 0.02,
      transmission: 0.82,
      ior: 1.43,
      thickness: 1.4,
      banding: 0.4
    }
  },
  {
    id: 24,
    name: "Garnet",
    zhName: "石榴石",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/garnet.glb",
    textureUrl: "",
    visual: {
      color: "#5D0A0A",
      roughness: 0.25,
      metalness: 0.03,
      transmission: 0.55,
      ior: 1.79,
      thickness: 1.3
    }
  },
  {
    id: 25,
    name: "Golden_Healer_Quartz",
    zhName: "黃金療癒者水晶",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/golden_healer_quartz.glb",
    textureUrl: "",
    visual: {
      color: "#F5D58A",
      roughness: 0.12,
      metalness: 0.05,
      transmission: 0.88,
      ior: 1.55,
      iridescence: 0.35
    }
  },
  {
    id: 26,
    name: "Hematite",
    zhName: "赤鐵礦",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/hematite.glb",
    textureUrl: "",
    visual: {
      color: "#4C4C4C",
      roughness: 0.2,
      metalness: 0.85,
      transmission: 0.0,
      ior: 2.95
    }
  },
  {
    id: 27,
    name: "Iolite",
    zhName: "堇青石",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/iolite.glb",
    textureUrl: "",
    visual: {
      color: "#394B9C",
      roughness: 0.28,
      metalness: 0.02,
      transmission: 0.55,
      ior: 1.53,
      pleochroism: 0.6
    }
  },
  {
    id: 28,
    name: "Jade",
    zhName: "玉",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/jade.glb",
    textureUrl: "",
    visual: {
      color: "#8DBF7A",
      roughness: 0.48,
      metalness: 0.02,
      transmission: 0.30,
      ior: 1.62
    }
  },
  {
    id: 29,
    name: "Labradorite",
    zhName: "拉長石",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/labradorite.glb",
    textureUrl: "",
    visual: {
      color: "#2E3A4B",
      roughness: 0.45,
      metalness: 0.1,
      transmission: 0.15,
      ior: 1.56,
      iridescence: 0.85,
      iridescenceThickness: 380
    }
  },
  {
    id: 30,
    name: "Lapis_Lazuli",
    zhName: "青金石",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/lapis_lazuli.glb",
    textureUrl: "",
    visual: {
      color: "#1C2A7A",
      roughness: 0.55,
      metalness: 0.05,
      transmission: 0.06,
      ior: 1.50,
      goldFlakes: 0.6
    }
  },
  {
    id: 31,
    name: "Lemurian_Quartz",
    zhName: "列木里亞水晶",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/lemurian_quartz.glb",
    textureUrl: "",
    visual: {
      color: "#FFFFFF",
      roughness: 0.10,
      metalness: 0.0,
      transmission: 0.93,
      ior: 1.55,
      thickness: 1.6,
      striations: 1.0
    }
  },
  {
    id: 32,
    name: "Lepidolite",
    zhName: "鋰雲母",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/lepidolite.glb",
    textureUrl: "",
    visual: {
      color: "#BFA4D8",
      roughness: 0.55,
      metalness: 0.05,
      transmission: 0.2,
      ior: 1.56,
      micaSparkle: 0.7
    }
  },
  {
    id: 33,
    name: "Malachite",
    zhName: "孔雀石",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/malachite.glb",
    textureUrl: "",
    visual: {
      color: "#1E7B4F",
      roughness: 0.45,
      metalness: 0.05,
      transmission: 0.12,
      ior: 1.65,
      banding: 1.0
    }
  },
  {
    id: 34,
    name: "Moonstone",
    zhName: "月光石",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/moonstone.glb",
    textureUrl: "",
    visual: {
      color: "#E8ECFF",
      roughness: 0.28,
      metalness: 0.03,
      transmission: 0.65,
      ior: 1.52,
      adularescence: 0.9
    }
  },
  {
    id: 35,
    name: "Ocean_Jasper",
    zhName: "海洋碧玉",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/ocean_jasper.glb",
    textureUrl: "",
    visual: {
      color: "#7AA86E",
      roughness: 0.58,
      metalness: 0.03,
      transmission: 0.15,
      ior: 1.54,
      orbPattern: 0.8
    }
  },
  {
    id: 36,
    name: "Phantom_Quartz",
    zhName: "幽靈水晶",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/phantom_quartz.glb",
    textureUrl: "",
    visual: {
      color: "#FFFFFF",
      roughness: 0.12,
      metalness: 0.0,
      transmission: 0.92,
      ior: 1.55,
      phantomLayer: 1.0
    }
  },
  {
    id: 37,
    name: "Pink_Opal",
    zhName: "粉蛋白石",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/pink_opal.glb",
    textureUrl: "",
    visual: {
      color: "#F6B7C8",
      roughness: 0.55,
      metalness: 0.0,
      transmission: 0.25,
      ior: 1.44
    }
  },
  {
    id: 38,
    name: "Pyrite",
    zhName: "黃鐵礦",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/pyrite.glb",
    textureUrl: "",
    visual: {
      color: "#A08C3A",
      roughness: 0.18,
      metalness: 0.92,
      transmission: 0.0,
      ior: 2.73
    }
  },
  {
    id: 39,
    name: "Rainbow_Obsidian",
    zhName: "彩虹黑曜石",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/rainbow_obsidian.glb",
    textureUrl: "",
    visual: {
      color: "#0A0A0A",
      roughness: 0.28,
      metalness: 0.02,
      transmission: 0.22,
      ior: 1.50,
      iridescence: 0.75
    }
  },
  {
    id: 40,
    name: "Red_Jasper",
    zhName: "紅碧玉",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/red_jasper.glb",
    textureUrl: "",
    visual: {
      color: "#A8322A",
      roughness: 0.52,
      metalness: 0.05,
      transmission: 0.10,
      ior: 1.54
    }
  },
  {
    id: 41,
    name: "Rhodochrosite",
    zhName: "菱錳礦",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/rhodochrosite.glb",
    textureUrl: "",
    visual: {
      color: "#F28C92",
      roughness: 0.42,
      metalness: 0.02,
      transmission: 0.35,
      ior: 1.60,
      banding: 0.8
    }
  },
  {
    id: 42,
    name: "Rhodonite",
    zhName: "薔薇輝石",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/rhodonite.glb",
    textureUrl: "",
    visual: {
      color: "#D8788A",
      roughness: 0.50,
      metalness: 0.03,
      transmission: 0.22,
      ior: 1.73,
      blackStripes: 0.7
    }
  },
  {
    id: 43,
    name: "Rose_Quartz",
    zhName: "粉晶",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/rose_quartz.glb",
    textureUrl: "",
    visual: {
      color: "#F7C8D9",
      roughness: 0.25,
      metalness: 0.0,
      transmission: 0.72,
      ior: 1.54,
      softGlow: 0.6
    }
  },
  {
    id: 44,
    name: "Selenite",
    zhName: "透石膏",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/selenite.glb",
    textureUrl: "",
    visual: {
      color: "#FFFFFF",
      roughness: 0.18,
      metalness: 0.0,
      transmission: 0.85,
      ior: 1.52,
      fiberOptic: 1.0
    }
  },
  {
    id: 45,
    name: "Shungite",
    zhName: "次石墨",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/shungite.glb",
    textureUrl: "",
    visual: {
      color: "#0F0F0F",
      roughness: 0.45,
      metalness: 0.08,
      transmission: 0.02,
      ior: 1.90
    }
  },
  {
    id: 46,
    name: "Smoky_Quartz",
    zhName: "煙水晶",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/smoky_quartz.glb",
    textureUrl: "",
    visual: {
      color: "#6A5A4A",
      roughness: 0.15,
      metalness: 0.0,
      transmission: 0.82,
      ior: 1.55,
      thickness: 1.4
    }
  },
  {
    id: 47,
    name: "Sodalite",
    zhName: "蘇打石",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/sodalite.glb",
    textureUrl: "",
    visual: {
      color: "#324B97",
      roughness: 0.48,
      metalness: 0.02,
      transmission: 0.10,
      ior: 1.50,
      whiteVeins: 0.7
    }
  },
  {
    id: 48,
    name: "Sunstone",
    zhName: "太陽石",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/sunstone.glb",
    textureUrl: "",
    visual: {
      color: "#E49E64",
      roughness: 0.38,
      metalness: 0.05,
      transmission: 0.28,
      ior: 1.55,
      aventurescence: 0.9
    }
  },
  {
    id: 49,
    name: "Tiger_Eye",
    zhName: "虎眼石",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/tiger_eye.glb",
    textureUrl: "",
    visual: {
      color: "#B88634",
      roughness: 0.42,
      metalness: 0.1,
      transmission: 0.15,
      ior: 1.54,
      chatoyancy: 1.0
    }
  },
  {
    id: 50,
    name: "Tourmalinated_Quartz",
    zhName: "黑髮晶",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/tourmalinated_quartz.glb",
    textureUrl: "",
    visual: {
      color: "#FFFFFF",
      roughness: 0.18,
      metalness: 0.0,
      transmission: 0.90,
      ior: 1.55,
      needleInclusions: 1.0
    }
  },
  {
    id: 51,
    name: "Turquoise",
    zhName: "綠松石",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/turquoise.glb",
    textureUrl: "",
    visual: {
      color: "#4EC4B0",
      roughness: 0.55,
      metalness: 0.02,
      transmission: 0.08,
      ior: 1.61,
      blackMatrix: 0.8
    }
  },
  {
    id: 52,
    name: "Zoisite_Granite",
    zhName: "綠簾花崗岩",
    glbUrl: "https://00OwOb00.github.io/Crystal-n-Wolf/models/zoisite_granite.glb",
    textureUrl: "",
    visual: {
      color: "#5A8C53",
      roughness: 0.60,
      metalness: 0.05,
      transmission: 0.05,
      ior: 1.70,
      graniteTexture: 1.0
    }
  }
];
</script>
<!-- ====== END PART 3/5 ====== -->
<!-- ========== index.html — PART 4/5 (3D Model Loader + Viewer) ========== -->
<script>
/* ------------------------------------------------------------------------
    Material Enhancement: Apply custom mineral visual parameters
------------------------------------------------------------------------ */
function applyCrystalMaterialEnhancement(mesh, visual) {
  mesh.traverse((child) => {
    if (!child.isMesh) return;

    const original = child.material;
    const mat = new THREE.MeshPhysicalMaterial({
      color: new THREE.Color(visual.color || "#ffffff"),
      roughness: visual.roughness ?? 0.3,
      metalness: visual.metalness ?? 0.0,
      transmission: visual.transmission ?? 0.0,
      ior: visual.ior ?? 1.5,
      thickness: visual.thickness ?? 1.0,
      envMapIntensity: 1.0,
      transparent: true
    });

    /* optional effects based on B4 natural mineral features */
    if (visual.iridescence) {
      mat.iridescence = visual.iridescence;
      mat.iridescenceIOR = 1.3;
      mat.iridescenceThicknessRange = [visual.iridescenceThickness || 200, (visual.iridescenceThickness || 200) + 150];
    }
    if (visual.dispersion) {
      mat.dispersion = visual.dispersion;
    }

    child.material = mat;
    if (original.dispose) original.dispose();
  });
}

/* ------------------------------------------------------------------------
    Load and display a model by ID
------------------------------------------------------------------------ */
async function loadCrystalById(crystalId) {
  const data = crystalsData.find(c => c.id === crystalId);
  if (!data) return;

  // clean previous model
  if (currentModelGroup) {
    scene.remove(currentModelGroup);
    currentModelGroup = null;
  }

  try {
    const gltf = await loadGLB(data.glbUrl);
    const model = gltf.scene || gltf.scenes[0];

    /* scale and center model */
    model.traverse((obj) => { if (obj.isMesh) obj.castShadow = false; });
    const box = new THREE.Box3().setFromObject(model);
    const size = new THREE.Vector3();
    box.getSize(size);

    const maxDim = Math.max(size.x, size.y, size.z);
    const s = 10 / maxDim;
    model.scale.setScalar(s);

    /* center */
    const center = new THREE.Vector3();
    box.getCenter(center);
    model.position.sub(center.multiplyScalar(s));

    /* apply natural mineral material */
    applyCrystalMaterialEnhancement(model, data.visual);

    /* fade-in group */
    const group = new THREE.Group();
    group.add(model);
    group.position.y = 0;

    // start tiny
    group.scale.set(0.001, 0.001, 0.001);
    scene.add(group);
    currentModelGroup = group;

    // animate in
    const start = performance.now();
    function fadeIn() {
      const t = (performance.now() - start) / 650;
      const k = Math.min(1, t);
      group.scale.setScalar(k);
      if (k < 1) requestAnimationFrame(fadeIn);
    }
    fadeIn();

  } catch (err) {
    console.error("Error loading GLB:", err);
  }
}

/* ------------------------------------------------------------------------
    DRAW A RANDOM CRYSTAL
------------------------------------------------------------------------ */
function drawRandomCrystal() {
  const random = crystalsData[Math.floor(Math.random() * crystalsData.length)];
  loadCrystalById(random.id);
  updatePanel(random);
  document.body.classList.add("result-mode");
}

/* ------------------------------------------------------------------------
    UPDATE RIGHT PANEL (meaning, message, etc.)
------------------------------------------------------------------------ */
function updatePanel(data) {
  const panel = document.getElementById("panel-content");
  panel.innerHTML = `
    <h2 style="font-size:26px;margin-bottom:8px;">${data.zhName} <span style="font-size:18px;opacity:.6;">${data.name}</span></h2>
    <p style="margin-bottom:12px;font-size:18px;line-height:1.5;"><strong>${data.message || ""}</strong></p>
    <p style="opacity:.7;">${data.question || ""}</p>
    <hr style="margin:20px 0;border:0;border-bottom:1px solid #ddd;" />
    <p style="font-size:16px;">${data.action || ""}</p>
    <div style="margin-top:12px;opacity:.75;font-size:14px;">${data.subAction || ""}</div>
  `;
}

/* ------------------------------------------------------------------------
    UI FUNCTIONS
------------------------------------------------------------------------ */
function startJourney() {
  document.getElementById("landing-content").style.display = "none";
  drawRandomCrystal();
}

function resetApp() {
  document.body.classList.remove("result-mode");
  document.getElementById("landing-content").style.display = "block";
  if (currentModelGroup) {
    scene.remove(currentModelGroup);
    currentModelGroup = null;
  }
}

/* ------------------------------------------------------------------------
    Music toggle
------------------------------------------------------------------------ */
function toggleMusic() {
  const audio = document.getElementById("bg-music");
  if (audio.paused) { audio.play(); }
  else { audio.pause(); }
}
</script>
<!-- ====== END PART 4/5 ====== -->
<!-- ========== index.html — PART 5/5 (UI finishing + END) ========== -->

<!-- UI Buttons -->
<style>
  #main-buttons {
    position: absolute;
    bottom: 60px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 20px;
    z-index: 5;
  }

  .action-btn {
    padding: 14px 26px;
    font-size: 18px;
    border-radius: 12px;
    border: none;
    background: rgba(255,255,255,0.15);
    backdrop-filter: blur(8px);
    color: white;
    cursor: pointer;
    transition: 0.2s;
  }
  .action-btn:hover {
    background: rgba(255,255,255,0.28);
  }

  /* When showing result state */
  body.result-mode #main-buttons {
    bottom: 30px;
  }
  body.result-mode #landing-content {
    display: none;
  }
</style>

<!-- Buttons -->
<div id="main-buttons">
  <button class="action-btn" onclick="startJourney()">我今天要專注的水晶</button>
  <button class="action-btn" onclick="toggleMusic()">音樂</button>
  <button class="action-btn" onclick="resetApp()">重抽</button>
</div>

<!-- Landing Screen Content -->
<div id="landing-content"
     style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
            text-align:center;color:white;z-index:3;max-width:600px;">
  <h1 style="font-size:40px;margin-bottom:20px;">Crystal n’ Wolf</h1>
  <p style="font-size:20px;opacity:.8;">點擊下方按鈕，抽出今天引導你的水晶。</p>
</div>

<!-- Right Panel -->
<div id="info-panel"
     style="position:absolute;top:0;right:0;width:360px;height:100%;
            background:rgba(255,255,255,0.85);backdrop-filter:blur(8px);
            padding:24px;overflow-y:auto;display:none;z-index:4;">
  <div id="panel-content"></div>
</div>

<script>
  /* When entering result mode, show right panel */
  const observer = new MutationObserver(()=>{
    if (document.body.classList.contains("result-mode")) {
      document.getElementById("info-panel").style.display = "block";
    }
  });
  observer.observe(document.body, { attributes: true });

  /* Auto resize 3D canvas to fill screen */
  window.addEventListener("resize", () => {
    if (renderer && camera) {
      renderer.setSize(window.innerWidth, window.innerHeight);
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
    }
  });
</script>

</body>
</html>
